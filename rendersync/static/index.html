<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rendersync</title>
    <link rel="icon" href="data:image/svg+xml,<svg viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">
    <link rel="stylesheet" href="/static/styles.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>    
    <script src="/static/script.js"></script>

</head>
<body>
    <!-- Top Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">rendersync</a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" onclick="shutdownServer()">Sign out</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="container-fluid">
        <nav id="sidebarMenu" class="d-md-block bg-light sidebar" style="width: 260px;">
                <div class="position-sticky pt-1">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showPage('dashboard')">
                                <i class="bi bi-speedometer2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('system')">
                                <i class="bi bi-gear"></i>
                                System & Network
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('ollama')">
                                <i class="bi bi-robot"></i>
                                Ollama
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('comfyui')">
                                <i class="bi bi-robot"></i>
                                ComfyUI
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h3" id="page-title">Dashboard</h1>
                </div>

                <!-- Page Content Container -->
                <div id="page-content">
                    <!-- Dashboard Page -->
                    <div id="dashboard-page" class="page-content">
                        <div class="row">
                            

                            <div class="card mb-4">
                                <div class="card-header">
                                    Server Status
                                </div>
                                <div class="card-body">
                                    <!-- Connection Control Panel -->
                                    <button id="refresh-server-info" onclick="loadServerInfo()" class="btn btn-primary mb-3">Refresh Server Info</button>
                                    <br>
                                    <div class="d-flex align-items-center gap-3">
                                        <button id="toggle-connections" onclick="toggleConnectionAccess()" class="btn btn-outline-danger">
                                            Disable External Connections
                                        </button>
                                        <div id="connection-indicator" class="rounded" style="width: 80px; height: 34px; background-color: #4caf50; border: 1px solid #6c757d; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 500; color: #212529;">
                                            <span id="connection-status-text">Enabled</span>
                                        </div>
                                    </div>
                                    <br>
                    
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Property</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody id="server-info-rows">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System & Network Page -->
                    <div id="system-page" class="page-content" style="display: none;">
                        <div class="row">
                            <div class="col-12">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="m-0 text-primary">System & Network Information</h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- Action Buttons -->
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <button id="refresh-system-info" onclick="loadSystemInfo()" class="btn btn-primary w-100 mb-2">Get System Info</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button id="refresh-terminal-info" onclick="loadTerminalInfo()" class="btn btn-primary w-100 mb-2">Get Terminal Info</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button id="refresh-apps-running-info" onclick="loadAppsRunningInfo()" class="btn btn-primary w-100 mb-2">Get Apps Running</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button id="refresh-network-info" onclick="loadNetworkInfo()" class="btn btn-primary w-100 mb-2">Get Network Info</button>
                                            </div>
                                        </div>

                                        <!-- Input Controls -->
                                        <div class="row mb-3">
                                            <div class="col-md-3">
                                                <input type="number" id="port-input" class="form-control" placeholder="Port (1-65535)" min="1" max="65535">
                                            </div>
                                            <div class="col-md-3">
                                                <button id="inspect-port" onclick="inspectPort()" class="btn btn-outline-primary w-100">Inspect Port</button>
                                            </div>
                                            
                                            <div class="col-md-3">
                                                <input type="text" id="pid-input" class="form-control" placeholder="Enter PID number">
                                            </div>
                                            <div class="col-md-3">
                                                <button id="inspect-pid" onclick="inspectPID()" class="btn btn-outline-primary w-100">Inspect PID</button>
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <input type="text" id="ping-input" class="form-control" placeholder="IP address or hostname">
                                            </div>
                                            <div class="col-md-2">
                                                <input type="number" id="ping-port-input" class="form-control" placeholder="Port (optional)" min="1" max="65535">
                                            </div>
                                            <div class="col-md-3">
                                                <button id="ping-ip" onclick="pingIP()" class="btn btn-outline-primary w-100">Ping IP</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button id="clear-results" onclick="clearSystemResults()" class="btn btn-outline-secondary w-100">Clear Table</button>
                                            </div>
                                        </div>

                                        <!-- Unified Results Table -->
                                        <div class="table-responsive">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>Property</th>
                                                        <th>Value</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="system-results-rows">
                                                    <tr>
                                                        <td colspan="2" class="text-center text-muted">Click any button above to load system information</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Browser Connections -->
                                        <div class="card mb-4">
                                            <div class="card-header">
                                                <h6 class="m-0 text-primary">Browser Connections</h6>
                                            </div>
                                            <div class="card-body">
                                                <button id="refresh-connections" onclick="loadConnections()" class="btn btn-primary mb-3">Refresh Connections</button>
                                                
                                                <div id="connections-console" class="connections-console">
                                                    <div class="console-header">
                                                        Browser Connections
                                                        <span id="connection-count">0 connections</span>
                                                    </div>
                                                    <div id="connections-log" class="console-log"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ollama Page -->
                    <div id="ollama-page" class="page-content" style="display: none;">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h6 class="m-0 text-primary">Ollama Management</h6>
                                    </div>
                                    <div class="card-body">
                                        <button id="inspect-ollama" onclick="inspectOllama()" class="btn btn-primary mb-3">Inspect ollama</button>
                                        <div class="table-responsive">
                                            <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Property</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="ollama-info-rows">
                            </tbody>
                        </table>
                                        </div>

                                        <div class="btn-group mb-3" role="group">
                                            <button id="start-ollama" onclick="startOllama()" class="btn btn-success">Start ollama</button>
                                            <button id="stop-ollama" onclick="stopOllama()" class="btn btn-danger">Stop ollama</button>
                                            <button id="get-models" onclick="getOllamaModels()" class="btn btn-info">Get ollama Models</button>
                                        </div>

                                        <div class="table-responsive">
                                            <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Property</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="ollama-action-rows">
                            </tbody>
                        </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-6">
                                <div class="card shadow mb-4">
                                    <div class="card-header">
                                        <h6 class="m-0 text-primary">Ollama Chat</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <input type="text" id="ollama-query-input" class="form-control" placeholder="Enter your question for Ollama">
                    </div>
                    
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <select id="ollama-model-select" class="form-select">
                            <option value="">Select Model</option>
                        </select>
                                            </div>
                                            <div class="col-md-6">
                                                <button id="query-ollama" onclick="queryOllama()" class="btn btn-primary">Query ollama</button>
                                            </div>
                                        </div>

                        <div id="ollama-chat" class="ollama-chat">
                            <div class="ollama-chat-header">
                                Ollama Console
                            </div>
                            <div id="ollama-chat-log" class="ollama-chat-log"></div>
                        </div>
                                    </div>
                    </div>
                </div>
            </div>
        </div>

                    <!-- ComfyUI Page -->
                    <div id="comfyui-page" class="page-content" style="display: none;">
                        <div class="card shadow mb-4">
                            <div class="card-header">
                                <h6 class="m-0 text-primary">ComfyUI Management</h6>
                            </div>
                            <div class="card-body">
                                <button id="inspect-comfyui" onclick="inspectComfyUI()" class="btn btn-primary mb-3">Inspect ComfyUI</button>
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Property</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="comfyui-info-rows">
                </tbody>
            </table>
                                </div>

                                <div class="btn-group mb-3" role="group">
                                    <button id="start-comfyui" onclick="startComfyUI()" class="btn btn-success">Start ComfyUI</button>
                                    <button id="stop-comfyui" onclick="stopComfyUI()" class="btn btn-danger">Stop ALL ComfyUI</button>
                                    <button id="open-comfyui-output-folder" onclick="openComfyUIOutputFolder()" class="btn btn-info">Open ComfyUI Output Folder</button>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Property</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="comfyui-action-rows">
                </tbody>
            </table>
                                </div>
                            </div>
                        </div>

                        <div class="card shadow mb-4">
                            <div class="card-header">
                                <h6 class="m-0 text-primary">Workflow Management</h6>
                            </div>
                            <div class="card-body">
                                <h6>Submit ComfyUI Workflow</h6>
                                <p class="text-muted">1: text-to-image, Stable Diffusion v1.5 (SD1.5)<br>
                                2: image-to-3D, Hunyuan3D V2.1</p>

                                <div class="table-responsive mb-3">
                                    <table class="table table-bordered">
                     <thead>
                         <tr>
                             <th>Workflow</th>
                             <th>Actions</th>
                             <th>Inspector</th>
                         </tr>
                     </thead>
                     <tbody id="workflow-rows">
                     </tbody>
                 </table>
             </div>

                                <div class="mb-3">
                                    <input type="file" id="workflow-file-input" accept=".json" class="form-control" style="display: none;" onchange="uploadComfyUIWorkflow()">
                                    <button onclick="document.getElementById('workflow-file-input').click()" class="btn btn-outline-secondary me-2">Upload Workflow</button>
                                    <button id="submit-workflow" onclick="submitComfyUIWorkflow()" class="btn btn-primary">Submit Workflow</button>
                                </div>
                
            <div id="comfyui-chat" class="comfyui-chat">
                <div class="comfyui-chat-header">
                    ComfyUI Console
                </div>
                <div id="comfyui-chat-log" class="comfyui-chat-log"></div>
            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

    <script>
        // Page navigation functionality
        function showPage(pageName) {
            // Hide all pages
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.style.display = 'none');
            
            // Show selected page
            const selectedPage = document.getElementById(pageName + '-page');
            if (selectedPage) {
                selectedPage.style.display = 'block';
            }
            
            // Update page title
            const pageTitle = document.getElementById('page-title');
            const titles = {
                'dashboard': 'Dashboard',
                'system': 'System & Network',
                'ollama': 'Ollama',
                'comfyui': 'ComfyUI'
            };
            pageTitle.textContent = titles[pageName] || 'Dashboard';
            
            // Update active nav link
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

    </script>
</body>
</html>